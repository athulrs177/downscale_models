name: Sync to GitLab Precipitation Directory

on:
  push:
    branches:
      - master  # Adjust this to your default branch name if different

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout GitHub repository content
        uses: actions/checkout@v2
        with:
          # Fetch only the latest commit to speed up the sync process
          fetch-depth: 1

      - name: Configure Git
        run: |
          git config --global user.email "athulrs177@gmail.com"
          git config --global user.name "Athul Rasheeda Satheesh"

      - name: Clone GitLab repository
        env:
          GITLAB_TOKEN: ${{ secrets.GITLAB_TOKEN }}
        run: |
          # Clone the GitLab repository with authentication
          git clone https://oauth2:${GITLAB_TOKEN}@gitlab.kit.edu/kit/imk-tro/wg-pinto/projects/aon.git gitlab-repo

      - name: Sync to Precipitation Directory in GitLab
        run: |
          # Remove current contents of the precipitation directory
          rm -rf gitlab-repo/precipitation/*
          
          # Copy all files from the root of the GitHub repository to the precipitation directory in GitLab, excluding gitlab-repo
          rsync -a --exclude='gitlab-repo' . gitlab-repo/precipitation/

      - name: Commit and push changes to GitLab
        run: |
          cd gitlab-repo
          git add precipitation/
          git commit -m "Sync changes from GitHub repository to precipitation directory in GitLab" || echo "No changes to commit"
          git push -f
